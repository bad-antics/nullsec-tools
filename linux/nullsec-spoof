#!/bin/bash
# ============================================================================
# NullSec Spoof - Identity & Traffic Spoofing Toolkit
# ============================================================================
# MAC, IP, DNS, and User-Agent spoofing for anonymity
# Licensed under NullSec Public License v1.0
# ============================================================================

VERSION="1.0.0"

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

DATA_DIR="$HOME/.local/share/nullsec/spoof"
mkdir -p "$DATA_DIR"

info() { echo -e "${CYAN}[*]${NC} $1"; }
success() { echo -e "${GREEN}[✓]${NC} $1"; }
warn() { echo -e "${YELLOW}[!]${NC} $1"; }
error() { echo -e "${RED}[✗]${NC} $1"; }

# Vendor MAC prefixes
declare -A VENDORS=(
    ["apple"]="00:1C:B3 00:1D:4F 00:1E:C2 00:21:E9 00:22:41 00:23:12 00:23:32 00:23:6C"
    ["samsung"]="00:12:47 00:15:99 00:16:32 00:17:C9 00:18:AF 00:1A:8A 00:1B:98 00:1C:43"
    ["intel"]="00:02:B3 00:03:47 00:04:23 00:07:E9 00:0C:F1 00:0E:0C 00:0E:35 00:11:11"
    ["cisco"]="00:00:0C 00:01:42 00:01:43 00:01:63 00:01:64 00:01:96 00:01:97 00:01:C7"
    ["dell"]="00:06:5B 00:08:74 00:0B:DB 00:0D:56 00:0F:1F 00:11:43 00:12:3F 00:13:72"
    ["random"]="02:00:00"
)

# User agents
USER_AGENTS=(
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 14_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15"
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"
    "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    "Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1"
    "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36"
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/120.0.0.0 Safari/537.36"
)

# Generate random MAC
generate_mac() {
    local vendor="${1:-random}"
    local prefix=""
    
    if [[ -n "${VENDORS[$vendor]}" ]]; then
        local prefixes=(${VENDORS[$vendor]})
        prefix="${prefixes[$RANDOM % ${#prefixes[@]}]}"
    else
        prefix="02:$(printf '%02x' $((RANDOM % 256))):$(printf '%02x' $((RANDOM % 256)))"
    fi
    
    echo "$prefix:$(printf '%02x:%02x:%02x' $((RANDOM % 256)) $((RANDOM % 256)) $((RANDOM % 256)))"
}

# Spoof MAC address
spoof_mac() {
    local iface="$1"
    local mac="${2:-$(generate_mac random)}"
    
    [[ -z "$iface" ]] && { error "Interface required"; return 1; }
    
    # Save original
    local orig=$(ip link show "$iface" 2>/dev/null | grep -oE 'link/ether [0-9a-f:]+' | awk '{print $2}')
    [[ -n "$orig" ]] && echo "$orig" > "$DATA_DIR/original_mac_$iface"
    
    info "Spoofing MAC on $iface to $mac..."
    
    sudo ip link set "$iface" down 2>/dev/null
    sudo ip link set "$iface" address "$mac" 2>/dev/null
    sudo ip link set "$iface" up 2>/dev/null
    
    local new=$(ip link show "$iface" 2>/dev/null | grep -oE 'link/ether [0-9a-f:]+' | awk '{print $2}')
    
    if [[ "$new" == "$mac" ]]; then
        success "MAC changed: $orig -> $new"
    else
        error "Failed to change MAC"
    fi
}

# Restore original MAC
restore_mac() {
    local iface="$1"
    
    [[ -z "$iface" ]] && { error "Interface required"; return 1; }
    
    if [[ -f "$DATA_DIR/original_mac_$iface" ]]; then
        local orig=$(cat "$DATA_DIR/original_mac_$iface")
        spoof_mac "$iface" "$orig"
        rm -f "$DATA_DIR/original_mac_$iface"
        success "MAC restored to $orig"
    else
        error "No saved MAC for $iface"
    fi
}

# Spoof hostname
spoof_hostname() {
    local new_hostname="${1:-nullsec-$(head -c 4 /dev/urandom | xxd -p)}"
    
    hostname > "$DATA_DIR/original_hostname"
    
    sudo hostname "$new_hostname"
    success "Hostname changed to $new_hostname"
    warn "Temporary - resets on reboot"
}

# Restore hostname
restore_hostname() {
    if [[ -f "$DATA_DIR/original_hostname" ]]; then
        local orig=$(cat "$DATA_DIR/original_hostname")
        sudo hostname "$orig"
        success "Hostname restored to $orig"
    else
        error "No saved hostname"
    fi
}

# Get random user agent
random_useragent() {
    echo "${USER_AGENTS[$RANDOM % ${#USER_AGENTS[@]}]}"
}

# Spoof DNS
spoof_dns() {
    local dns1="${1:-9.9.9.9}"
    local dns2="${2:-149.112.112.112}"
    
    # Backup
    [[ ! -f "$DATA_DIR/resolv.conf.bak" ]] && cp /etc/resolv.conf "$DATA_DIR/resolv.conf.bak"
    
    info "Setting DNS to $dns1, $dns2..."
    
    cat << EOF | sudo tee /etc/resolv.conf > /dev/null
# NullSec Spoofed DNS
nameserver $dns1
nameserver $dns2
EOF
    
    success "DNS spoofed"
}

# Restore DNS
restore_dns() {
    if [[ -f "$DATA_DIR/resolv.conf.bak" ]]; then
        sudo cp "$DATA_DIR/resolv.conf.bak" /etc/resolv.conf
        success "DNS restored"
    else
        error "No DNS backup found"
    fi
}

# Full identity spoof
full_spoof() {
    local iface="${1:-$(ip route | grep default | awk '{print $5}' | head -1)}"
    
    warn "Full identity spoof on $iface"
    
    spoof_mac "$iface" "$(generate_mac random)"
    spoof_hostname
    spoof_dns "9.9.9.9" "149.112.112.112"
    
    echo ""
    success "Identity spoofed!"
    echo -e "  Interface: $iface"
    echo -e "  MAC: $(ip link show $iface | grep -oE 'link/ether [0-9a-f:]+' | awk '{print $2}')"
    echo -e "  Hostname: $(hostname)"
    echo -e "  DNS: $(grep nameserver /etc/resolv.conf | head -1 | awk '{print $2}')"
}

# Restore all
restore_all() {
    local iface="${1:-$(ip route | grep default | awk '{print $5}' | head -1)}"
    
    restore_mac "$iface"
    restore_hostname
    restore_dns
    
    success "Identity restored"
}

# Status
show_status() {
    echo -e "\n${CYAN}${BOLD}═══ Spoof Status ═══${NC}\n"
    
    local iface=$(ip route | grep default | awk '{print $5}' | head -1)
    
    echo -e "${WHITE}Network Interface:${NC} $iface"
    echo -e "${WHITE}Current MAC:${NC} $(ip link show $iface 2>/dev/null | grep -oE 'link/ether [0-9a-f:]+' | awk '{print $2}')"
    [[ -f "$DATA_DIR/original_mac_$iface" ]] && echo -e "${WHITE}Original MAC:${NC} $(cat $DATA_DIR/original_mac_$iface)"
    
    echo -e "${WHITE}Hostname:${NC} $(hostname)"
    [[ -f "$DATA_DIR/original_hostname" ]] && echo -e "${WHITE}Original Hostname:${NC} $(cat $DATA_DIR/original_hostname)"
    
    echo -e "${WHITE}DNS:${NC} $(grep nameserver /etc/resolv.conf | head -1 | awk '{print $2}')"
    echo ""
}

# Help
show_help() {
    cat << 'HELP'
NullSec Spoof - Identity & Traffic Spoofing Toolkit

USAGE:
    nullsec-spoof <command> [options]

MAC COMMANDS:
    mac <iface> [address]     Spoof MAC address
    mac-gen [vendor]          Generate random MAC
    mac-restore <iface>       Restore original MAC

IDENTITY COMMANDS:
    hostname [name]           Spoof hostname
    hostname-restore          Restore hostname
    dns <dns1> [dns2]         Spoof DNS servers
    dns-restore               Restore DNS

FULL COMMANDS:
    full [iface]              Full identity spoof
    restore [iface]           Restore all
    status                    Show current status
    useragent                 Get random user agent

VENDORS:
    apple, samsung, intel, cisco, dell, random

EXAMPLES:
    nullsec-spoof mac eth0
    nullsec-spoof mac wlan0 $(nullsec-spoof mac-gen apple)
    nullsec-spoof full
    nullsec-spoof restore

LICENSE:
    NullSec Public License v1.0
HELP
}

case "$1" in
    -h|--help|help|"") show_help ;;
    mac) shift; spoof_mac "$@" ;;
    mac-gen|generate) shift; generate_mac "$@" ;;
    mac-restore) shift; restore_mac "$@" ;;
    hostname|host) shift; spoof_hostname "$@" ;;
    hostname-restore|host-restore) restore_hostname ;;
    dns) shift; spoof_dns "$@" ;;
    dns-restore) restore_dns ;;
    full|all) shift; full_spoof "$@" ;;
    restore) shift; restore_all "$@" ;;
    status|st) show_status ;;
    useragent|ua) random_useragent ;;
    *) error "Unknown: $1"; show_help; exit 1 ;;
esac
